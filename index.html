<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="chat">
    <meta name="keywords" content="get x">
    <meta name="author" content="chat test">
    <title>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ CSS -->
    <link rel="stylesheet" href="styles.css">
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ —Å–∞–π—Ç–∞ (favicon) -->
<!--    <link rel="icon" href="favicon.ico" type="image/x-icon">-->
</head>
<body>

<header>
<!--    <h1>Chat x</h1>-->

</header>

<body>
<p id="coordinates">–ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã...</p>
<p id="location">–û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...</p>
<div id="map" style="width:100%; height:350px; margin-top:20px; border:1px solid #ddd;">
    –ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...
</div>

<script>
    window.onload = function() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                async function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    // –í—ã–≤–æ–¥–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                    document.getElementById("coordinates").innerHTML =
                        `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: –®–∏—Ä–æ—Ç–∞ ${lat}, –î–æ–ª–≥–æ—Ç–∞ ${lon}`;

                    // –í—Å—Ç–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç—É Google Maps
                    const iframe = document.createElement('iframe');
                    iframe.setAttribute('src',
                        `https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d10000!2d${lon}!3d${lat}!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sru!4v${Date.now()}!5m2!1sen!2sru`
                    );
                    iframe.setAttribute('width', '100%');
                    iframe.setAttribute('height', '350');
                    iframe.setAttribute('style', 'border:0;');
                    iframe.setAttribute('allowfullscreen', '');
                    iframe.setAttribute('loading', 'lazy');

                    document.getElementById('map').innerHTML = '';
                    document.getElementById('map').appendChild(iframe);

                    // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
                    try {
                        const response = await fetch(
                            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`
                        );
                        const data = await response.json();
                        const address = data.address;
                        let locationInfo = "";

                        if (address.city || address.town || address.village) {
                            locationInfo += address.city || address.town || address.village;
                        }
                        if (address.country) {
                            locationInfo += `, ${address.country}`;
                        }

                        if (data.display_name) {
                            locationInfo = data.display_name;
                        }

                        document.getElementById("location").innerHTML =
                            `–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: <strong>${locationInfo}</strong>`;
                    } catch (error) {
                        document.getElementById("location").innerHTML =
                            "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–¥—Ä–µ—Å";
                    }
                },
                function(error) {
                    document.getElementById("coordinates").innerHTML =
                        "–û—à–∏–±–∫–∞: " + error.message;
                }
            );
        } else {
            document.getElementById("coordinates").innerHTML =
                "–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é";
        }
    };
</script>

<!--<p id="coordinates">–ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã...</p>-->
<!--<p id="location">–û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...</p>-->

<!--<script>-->
<!--    window.onload = function() {-->
<!--        if (navigator.geolocation) {-->
<!--            navigator.geolocation.getCurrentPosition(-->
<!--                async function(position) {-->
<!--                    const lat = position.coords.latitude;-->
<!--                    const lon = position.coords.longitude;-->

<!--                    // –í—ã–≤–æ–¥–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã-->
<!--                    document.getElementById("coordinates").innerHTML =-->
<!--                        `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: –®–∏—Ä–æ—Ç–∞ ${lat}, –î–æ–ª–≥–æ—Ç–∞ ${lon}`;-->

<!--                    // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º (reverse geocoding)-->
<!--                    try {-->
<!--                        const response = await fetch(-->
<!--                            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`-->
<!--                        );-->
<!--                        const data = await response.json();-->

<!--                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏-->
<!--                        const address = data.address;-->
<!--                        let locationInfo = "";-->

<!--                        if (address.city || address.town || address.village) {-->
<!--                            locationInfo += address.city || address.town || address.village;-->
<!--                        }-->
<!--                        if (address.country) {-->
<!--                            locationInfo += `, ${address.country}`;-->
<!--                        }-->

<!--                        // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å-->
<!--                        if (data.display_name) {-->
<!--                            locationInfo = data.display_name;-->
<!--                        }-->

<!--                        document.getElementById("location").innerHTML =-->
<!--                            `–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: <strong>${locationInfo}</strong>`;-->
<!--                    } catch (error) {-->
<!--                        document.getElementById("location").innerHTML =-->
<!--                            "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–¥—Ä–µ—Å";-->
<!--                    }-->
<!--                },-->
<!--                function(error) {-->
<!--                    document.getElementById("coordinates").innerHTML =-->
<!--                        "–û—à–∏–±–∫–∞: " + error.message;-->
<!--                }-->
<!--            );-->
<!--        } else {-->
<!--            document.getElementById("coordinates").innerHTML =-->
<!--                "–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é";-->
<!--        }-->
<!--    };-->
<!--</script>-->
<!-- –®–∞–ø–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->



<!--<iframe-->
<!--        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2245.373789168169!2d37.61729931593087!3d55.75582698055248!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x46b54a5a738fa419%3A0x7c347d506f52311!2sRed%20Square!5e0!3m2!1sen!2sru!4v1620000000000!5m2!1sen!2sru"-->
<!--        width="100%"-->
<!--        height="350vh"-->
<!--        style="border:0;"-->
<!--        allowfullscreen=""-->
<!--        loading="lazy">-->
<!--</iframe>-->

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<main>

</main>

<!-- –ü–æ–¥–≤–∞–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<footer>
<!--    <p>&copy;2025</p>-->
</footer>

<!-- —á–∞—Ç -->
<link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />
<style>
    :root {
        --chat--color-primary: #e74266;
        --chat--color-primary-shade-50: #db4061;
        --chat--color-primary-shade-100: #cf3c5c;
        --chat--color-secondary: #20b69e;
        --chat--color-secondary-shade-50: #1ca08a;
        --chat--color-white: #ffffff;
        --chat--color-light: #f2f4f8;
        --chat--color-light-shade-50: #e6e9f1;
        --chat--color-light-shade-100: #c2c5cc;
        --chat--color-medium: #d2d4d9;
        --chat--color-dark: #afffa0;
        --chat--color-disabled: #777980;
        --chat--color-typing: #404040;
        --chat--spacing: 1rem;
        --chat--border-radius: 0.25rem;
        --chat--transition-duration: 0.15s;
        --chat--window--width: 400px;
        --chat--window--height: 600px;
        --chat--header-height: 50px;
        /*--chat--header-height: auto;*/
        --chat--header--padding: var(--chat--spacing);
        --chat--header--background: var(--chat--color-dark);
        --chat--header--color: var(--chat--color-light);
        --chat--header--border-top: none;
        --chat--header--border-bottom: none;
        --chat--heading--font-size: 2em;
        --chat--subtitle--font-size: inherit;
        --chat--subtitle--line-height: 1.8;
        --chat--textarea--height: 50px;
        --chat--message--font-size: 1rem;
        --chat--message--padding: var(--chat--spacing);
        --chat--message--border-radius: var(--chat--border-radius);
        --chat--message-line-height: 1.8;
        --chat--message--bot--background: var(--chat--color-white);
        --chat--message--bot--color: var(--chat--color-dark);
        --chat--message--bot--border: none;
        --chat--message--user--background: var(--chat--color-secondary);
        --chat--message--user--color: var(--chat--color-white);
        --chat--message--user--border: none;
        --chat--message--pre--background: rgba(0, 0, 0, 0.05);
        --chat--toggle--background: var(--chat--color-primary);
        --chat--toggle--hover--background: var(--chat--color-primary-shade-50);
        --chat--toggle--active--background: var(--chat--color-primary-shade-100);
        --chat--toggle--color: var(--chat--color-white);
        --chat--toggle--size: 100px;
    }
</style>
<script type="module">
    import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

    // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
    navigator.geolocation.getCurrentPosition(
        async (position) => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å —á–µ—Ä–µ–∑ Nominatim
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`
                );
                const data = await response.json();
                const address = data.display_name || 'Unknown location';

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —á–∞—Ç —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏
                initChat(address, lat, lon);
            } catch (error) {
                console.error('Geocoding error:', error);
                initChat(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏
            }
        },
        (error) => {
            console.error('Geolocation error:', error);
            initChat(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏
        }
    );

    function initChat(address = null, lat = null, lon = null) {
        createChat({
            webhookUrl: 'https://ntimer.com/webhook/df19d314-9eae-4992-ad8a-df56fc35ca63/chat',
            webhookConfig: {
                method: 'POST',
                headers: { }
            },
            target: '#n8n-chat',
            mode: 'window',
            chatInputKey: 'chatInput',
            chatSessionKey: 'sessionId',
            metadata: {
                location: address,
                coordinates: lat && lon ? `${lat},${lon}` : null
            },
            showWelcomeScreen: false,
            defaultLanguage: 'en',
            initialMessages: [
                'Hi! üëã',
                address ? `I see you're near ${address}. How can I help?` : 'How can I help you today?'
            ],
            i18n: {
                en: {
                    title: 'Hello! üëã',
                    subtitle: "24/7",
                    footer: '',
                    getStarted: 'new conversation',
                    inputPlaceholder: 'input your request..',
                },
            },
        });
    }
</script>


</body>
</html>